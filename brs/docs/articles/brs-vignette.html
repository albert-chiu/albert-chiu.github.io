<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="brs">
<title>brs: Bayesian Rule Set • brs</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="brs: Bayesian Rule Set">
<meta property="og:description" content="brs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">brs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9007</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/brs-vignette.html">brs: Bayesian Rule Set</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>brs: Bayesian Rule Set</h1>
            
      
      
      <div class="d-none name"><code>brs-vignette.Rmd</code></div>
    </div>

    
    
<p><strong>R</strong> package for <em>Bayesian Rule Set: A Quantitative
Alternative to Qualitative Comparative Analysis.</em></p>
<p><strong>References</strong>:</p>
<ul>
<li>Chiu, Albert and Yiqing Xu. “Bayesian Rule Set: A Quantitative
Alternative to Qualitative Comparative Analysis.” <em>The Journal of
Politics</em> 85, no. 1 (2023):.</li>
<li>Wang, Tong, Cynthia Rudin, Finale Doshi-Velez, Yimin Liu, Erica
Klampfl, and Perry MacNeille. “A bayesian framework for learning rule
sets for interpretable classification.” <em>The Journal of Machine
Learning Research</em> 18, no. 1 (2017): 2357-2393.</li>
</ul>
<p><strong>R</strong> source files can be found on <a href="https://github.com/albert-chiu/brs" class="external-link">GitHub</a>. <strong>R</strong>
code used in this demonstration can also be downloaded from <a href="https://github.com/albert-chiu/brs/tree/main/vignettes" class="external-link">GitHub</a>.</p>
<div class="section level2">
<h2 id="installing-brs-and-python">Installing <tt>{brs}</tt> and Python<a class="anchor" aria-label="anchor" href="#installing-brs-and-python"></a>
</h2>
<p><tt>{brs}</tt> is not currently on CRAN and thus must be installed
from GitHub. This can be done using the following code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#devtools::install_github("albert-chiu/brs")</span></span></code></pre></div>
<p><tt>{brs}</tt> uses source code written in Python and requires, in
addition to the package itself, an installation of Python. We recommend
<a href="https://github.com/conda-forge/miniforge" class="external-link">miniforge</a> due to
the variety of CPU architectures they support, which will hopefully
preempt some incompatibility errors that would otherwise arise, although
any installation that works will do.</p>
</div>
<div class="section level2">
<h2 id="preliminaries">Preliminaries<a class="anchor" aria-label="anchor" href="#preliminaries"></a>
</h2>
<p><tt>{brs}</tt> uses the <a href="https://rstudio.github.io/reticulate/" class="external-link"><tt>reticulate</tt></a>
package to run source code written in Python and requires a bit of
setup. In our experience, we find that this process can vary depending
on your hardware and software and may require some trouble-shooting.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First create conda environment </span></span>
<span><span class="co"># do this *before* loading the brs package. If you've already loaded brs or </span></span>
<span><span class="co">#   have been using reticulate, you may need to restart R and rerun your code</span></span>
<span><span class="co">#   in the order shown below</span></span>
<span><span class="co"># Note: this code is for computers with Apple silicon (M1, etc.) and the </span></span>
<span><span class="co">#   corresponding miniforge installation </span></span>
<span></span>
<span><span class="co"># install python and packages to environment</span></span>
<span><span class="co"># note: this requires an Internet connection</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/conda-tools.html" class="external-link">conda_install</a></span><span class="op">(</span>envname <span class="op">=</span> <span class="st">"~/miniforge3/envs/BRS_conda"</span>,</span>
<span>  conda<span class="op">=</span><span class="st">"~/miniforge3/condabin/conda"</span>,  <span class="co"># path to conda binary</span></span>
<span>  packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"numpy"</span>, <span class="st">"pandas"</span>, <span class="st">"scikit-learn"</span>, <span class="st">"scipy"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; + '/Users/albertchiu/miniforge3/bin/conda' 'install' '--yes' '--prefix' '/Users/albertchiu/miniforge3/envs/BRS_conda' '-c' 'conda-forge' 'numpy' 'pandas' 'scikit-learn' 'scipy'</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_condaenv</a></span><span class="op">(</span>condaenv<span class="op">=</span><span class="st">"~/miniforge3/envs/BRS_conda"</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># load brs package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">brs</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-the-brs-algorithm">Running the BRS algorithm<a class="anchor" aria-label="anchor" href="#running-the-brs-algorithm"></a>
</h2>
<p>The BRS algorithm requires a number of hyperparameters (see the above
references). Our function has default values for all but maximum length
of the rule. Other than that, you must supply the <tt>BRS</tt> function
with a dataframe containing all explanatory variables and a separate
outcome vector.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># load data for example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lipset_df"</span>, <span class="st">"lipset_Y"</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># BRS without bootstrapping on entire sample</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">brs</span><span class="fu">::</span><span class="fu"><a href="../reference/BRS.html">BRS</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">lipset_df</span>, Y <span class="op">=</span> <span class="va">lipset_Y</span>, seed <span class="op">=</span> <span class="fl">123</span>, maxLen<span class="op">=</span><span class="fl">3L</span>, </span>
<span>               trainProp <span class="op">=</span> <span class="fl">1</span>, bootstrap <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Rule Sets`</span></span>
<span><span class="co">#&gt; $`Rule Sets`$`0`</span></span>
<span><span class="co">#&gt; $`Rule Sets`$`0`[[1]]</span></span>
<span><span class="co">#&gt; [1] "LITERACY_0_neg" "GNPCAP_0_neg"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Indices</span></span>
<span><span class="co">#&gt; named list()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Stats</span></span>
<span><span class="co">#&gt;   accuracy tpr fpr</span></span>
<span><span class="co">#&gt; 1      NaN NaN NaN</span></span></code></pre></div>
<p>The function will output a list with three entries. The first will be
the rule sets themselves. If you do not bootstrap, then there will only
be one rule set, which itself will be formatted as a list of vectors,
where each vector corresponds to a rule. If you do bootstrap, the first
return entry will be a list of lists. The second entry will be a list of
indices of the observations used for each bootstrapped sample. Some
other functions in our package will access these indices, but they will
likely not be of much interest independent of this. If you do not
bootstrap, the second entry will be empty. The third entry will be a
dataframe of out-of-sample performance statistics. If you choose to use
a train/test split (which is the default), the function will fit a rule
set on the training set and then evaluate its accuracy, true positive
rate (tpr), and false positive rate (fpr) on the test set. Otherwise,
this will come back populated with NaNs.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># BRS without bootstrapping, with train/test split</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">brs</span><span class="fu">::</span><span class="fu"><a href="../reference/BRS.html">BRS</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">lipset_df</span>, Y <span class="op">=</span> <span class="va">lipset_Y</span>, seed <span class="op">=</span> <span class="fl">123</span>, maxLen<span class="op">=</span><span class="fl">3L</span>, </span>
<span>               bootstrap <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span>  <span class="co"># default split is .7 training/.3 test</span></span>
<span><span class="co">#&gt; $`Rule Sets`</span></span>
<span><span class="co">#&gt; $`Rule Sets`$`0`</span></span>
<span><span class="co">#&gt; $`Rule Sets`$`0`[[1]]</span></span>
<span><span class="co">#&gt; [1] "INDLAB_1"       "URBANIZA_0_neg" "GNPCAP_1_neg"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Rule Sets`$`0`[[2]]</span></span>
<span><span class="co">#&gt; [1] "GNPCAP_0_neg" "URBANIZA_0"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Indices</span></span>
<span><span class="co">#&gt; named list()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Stats</span></span>
<span><span class="co">#&gt;    accuracy tpr  fpr</span></span>
<span><span class="co">#&gt; 1 0.6666667 0.5 0.25</span></span></code></pre></div>
<p>We can also bootstrap to obtain many rule sets. We will be using this
for the remainder of this vignette.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run BRS with default parameters</span></span>
<span><span class="va">out_lipset</span> <span class="op">&lt;-</span> <span class="fu">brs</span><span class="fu">::</span><span class="fu"><a href="../reference/BRS.html">BRS</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">lipset_df</span>, Y <span class="op">=</span> <span class="va">lipset_Y</span>, seed <span class="op">=</span> <span class="fl">123</span>, </span>
<span>                       maxLen<span class="op">=</span><span class="fl">3L</span>, bootstrap <span class="op">=</span> <span class="cn">T</span>, reps<span class="op">=</span><span class="fl">100L</span><span class="op">)</span></span>
<span><span class="va">out_lipset</span><span class="op">[[</span><span class="st">"Rule Sets"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span> <span class="op">]</span></span>
<span><span class="co">#&gt; $`0`</span></span>
<span><span class="co">#&gt; $`0`[[1]]</span></span>
<span><span class="co">#&gt; [1] "GNPCAP_1_neg"   "LITERACY_0_neg" "GNPCAP_0_neg"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`0`[[2]]</span></span>
<span><span class="co">#&gt; [1] "INDLAB_1_neg" "GNPCAP_0_neg"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`1`</span></span>
<span><span class="co">#&gt; $`1`[[1]]</span></span>
<span><span class="co">#&gt; [1] "GNPCAP_0_neg"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`2`</span></span>
<span><span class="co">#&gt; $`2`[[1]]</span></span>
<span><span class="co">#&gt; [1] "LITERACY_0_neg" "GNPCAP_0_neg"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`3`</span></span>
<span><span class="co">#&gt; $`3`[[1]]</span></span>
<span><span class="co">#&gt; [1] "URBANIZA_0_neg"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`4`</span></span>
<span><span class="co">#&gt; $`4`[[1]]</span></span>
<span><span class="co">#&gt; [1] "INDLAB_1_neg"   "LITERACY_0_neg" "GNPCAP_1"      </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`4`[[2]]</span></span>
<span><span class="co">#&gt; [1] "URBANIZA_0_neg"</span></span>
<span><span class="va">out_lipset</span><span class="op">[[</span><span class="st">"Indices"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span> <span class="op">]</span></span>
<span><span class="co">#&gt; $`0`</span></span>
<span><span class="co">#&gt;  [1] 13  2  2  6 17 10  1  0 17 15  9  0 14  0 15 14  4  0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`1`</span></span>
<span><span class="co">#&gt;  [1]  7 11 14 11  8  9  3 13  5  3 11 11  5  1 16 13 10 14</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`2`</span></span>
<span><span class="co">#&gt;  [1] 12  1 17 15 10  1 11  0  6  1 16 15  1  5  3 12  9  6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`3`</span></span>
<span><span class="co">#&gt;  [1]  7 15  0 17  4 10  9 14  8  5  8  4 17 14 12  5  0 17</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`4`</span></span>
<span><span class="co">#&gt;  [1]  4  1  7 12  2 11 12 15  4  8 16 12 12  5  3  9  1  4</span></span>
<span><span class="va">out_lipset</span><span class="op">[[</span><span class="st">"Stats"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;    accuracy       tpr       fpr</span></span>
<span><span class="co">#&gt; 1         1         1         0</span></span>
<span><span class="co">#&gt; 2         1         1         0</span></span>
<span><span class="co">#&gt; 3 0.8333333         1       0.2</span></span>
<span><span class="co">#&gt; 4       0.5         0      0.25</span></span>
<span><span class="co">#&gt; 5       0.5 0.3333333 0.3333333</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-a-bar-graph">Creating a bar graph<a class="anchor" aria-label="anchor" href="#creating-a-bar-graph"></a>
</h2>
<p>To visualize the bootstrapped rule sets, we recommend first making a
bar graph. Before we create the graph, we need to create some objects to
help our function label and simplify features. First, we need to create
a dataframe with labels of your variables.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">lipset_df</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wealth (high)"</span>, <span class="st">"Wealth (med)"</span>, <span class="st">"Wealth (low)"</span>,</span>
<span>               <span class="st">"Urbanization (high)"</span>, <span class="st">"Urbanization (low)"</span>, </span>
<span>               <span class="st">"Education (high)"</span>, <span class="st">"Education (low)"</span>, </span>
<span>               <span class="st">"Industrialization (high)"</span>, <span class="st">"Industrialization (low)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a low effort stopgap is to use the variable names as they appear in your data:</span></span>
<span><span class="co"># fdf &lt;- cbind(colnames(lipset_df), colnames(lipset_df))</span></span></code></pre></div>
<p>Next, optionally you can simplify features that are equivalent by
defining equivalence classes. You can skip this set (and set the
<tt>simplify</tt> argument of the <tt>plot_bar</tt> function to
<tt>FALSE</tt>) if you find it to burdensome, but we recommend that you
do this if you are at a more serious stage in the research process.</p>
<p>For example, if you have a binary variable <span class="math inline">\(X\)</span>, you can change all rules with ‘not
<span class="math inline">\(X\)</span>=0’ to ‘<span class="math inline">\(X\)</span>=1’ and all rules with ‘not <span class="math inline">\(X=1\)</span>’ to ‘<span class="math inline">\(X=0\)</span>.’ To do this, you need two objects: a
list of (vectors of) variable names <tt>oppind</tt> and a matrix of
values <tt>oppmat</tt>. The <span class="math inline">\(i\)</span>th
index <tt>oppind</tt> corresponds to the <span class="math inline">\(i\)</span>th row of <tt>oppmat</tt>.
<tt>oppmat</tt> will have two columns, each containing one of the two
possible values of the binary variables in the respective entry of
<tt>oppind</tt>.</p>
<p>For our democracy example, there are three binary variables (and no
other variables) for which we would like to create equivalence
classes:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create </span></span>
<span><span class="co">#oppind &lt;- list(unique(unlist(lapply(colnames(lipset_df), </span></span>
<span>                <span class="co">#function(x) strsplit(x, "_")[[1]][[1]])))[2:4])</span></span>
<span><span class="va">oppind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"URBANIZA"</span>, <span class="st">"LITERACY"</span>, <span class="st">"INDLAB"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Each of these variables can take on either the value 0 or 1.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oppmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We could have more possible duos of values, e.g., for a variable like
<tt>GNPCAP</tt> with three possible values, ‘low,’ ‘med,’ and ‘high,’ if
we create overlapping binary categories ‘low,’ ‘medium or high,’ and
‘high’ (which in this example we did not), another duo might be ‘low’
and ‘medium or high.’ This would require its own row of <tt>oppmat</tt>
and entry in <tt>oppind</tt>. If we also have a ‘low or medium’
category, this would require a separate entry. For example:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oppind_lmh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GNPCAP"</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GNPCAP"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">oppmat_lmh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"med_or_high"</span><span class="op">)</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low_or_med"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">oppind_lmh</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "GNPCAP"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "GNPCAP"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">oppmat_lmh</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1]         [,2]         </span></span>
<span><span class="co">#&gt; [1,] "low"        "med_or_high"</span></span>
<span><span class="co">#&gt; [2,] "low_or_med" "high"</span></span></code></pre></div>
<p>Finally, we can make our barplot (see documentation for more thurough
explanation of each argument, as well as their default values):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lipset_bar</span> <span class="op">&lt;-</span> <span class="fu">brs</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_bar.html">plot_bar</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">lipset_df</span>, Y<span class="op">=</span><span class="va">lipset_Y</span>, fit <span class="op">=</span> <span class="va">out_lipset</span>, </span>
<span>    featureLabels <span class="op">=</span> <span class="va">fdf</span>, maxLen<span class="op">=</span><span class="fl">3</span>, boot_rep <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>    minProp <span class="op">=</span> <span class="fl">.05</span>,  <span class="co"># rules must appear in at least 5% of bootstraps</span></span>
<span>    topRules<span class="op">=</span><span class="fl">5</span>,  <span class="co"># plot at most the top five rules of each length</span></span>
<span>    simplify <span class="op">=</span> <span class="cn">T</span>, oppmat<span class="op">=</span><span class="va">oppmat</span>, oppind<span class="op">=</span><span class="va">oppind</span>, </span>
<span>    and <span class="op">=</span><span class="st">" &amp; "</span>,  <span class="co"># how to display the 'and' operator</span></span>
<span>    plotBuffer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">0</span>, <span class="fl">.4</span><span class="op">)</span>,  <span class="co"># white spacing around plot</span></span>
<span>    titleSize<span class="op">=</span><span class="fl">10</span>, rule_text_size <span class="op">=</span> <span class="fl">10</span>, number_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>  <span class="co"># visual parameters</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">lipset_bar</span><span class="op">)</span></span></code></pre></div>
<p><img src="brs-vignette_files/figure-html/print-barplot-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="making-a-chord-diagram">Making a chord diagram<a class="anchor" aria-label="anchor" href="#making-a-chord-diagram"></a>
</h2>
<p>To visualize the interactions present in a single rule set, we
recommend using a chord diagram. This could either be the rule set you
found without bootstrapping, or the aggregated rule set with
bootstrapping. We plot the latter (though in this example they are the
same). Note that this graph is agnostic to how you obtain the rule set,
meaning it can also be used with QCA or any other method.</p>
<p>To plot the chord diagram, we also need to create a dataframe that
maps the variable names as they appear in our data (first column) to the
variable names as we want them to appear in our graph (second
column).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Feature names (without values) as they appear in X and their corresponding labels</span></span>
<span><span class="va">fgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">lipset_df</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"_"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wealth"</span>, <span class="st">"Urbanization"</span>, <span class="st">"Education"</span>, <span class="st">"Industrialization"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fgs</span></span>
<span><span class="co">#&gt;      [,1]       [,2]               </span></span>
<span><span class="co">#&gt; [1,] "GNPCAP"   "Wealth"           </span></span>
<span><span class="co">#&gt; [2,] "URBANIZA" "Urbanization"     </span></span>
<span><span class="co">#&gt; [3,] "LITERACY" "Education"        </span></span>
<span><span class="co">#&gt; [4,] "INDLAB"   "Industrialization"</span></span></code></pre></div>
<p>We then obtain and plot the aggregated rule set.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get aggregated rule set</span></span>
<span><span class="va">ruleset</span> <span class="op">&lt;-</span> <span class="fu">brs</span><span class="fu">::</span><span class="fu"><a href="../reference/agg_BRS.html">agg_BRS</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">out_lipset</span>, X <span class="op">=</span> <span class="va">lipset_df</span>, Y<span class="op">=</span><span class="va">lipset_Y</span>, maxLen<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_chord.html">plot_chord</a></span><span class="op">(</span>ruleSet<span class="op">=</span><span class="va">ruleset</span>, featureGroups<span class="op">=</span><span class="va">fgs</span>,</span>
<span>           <span class="co">#linkColors=RColorBrewer::brewer.pal(11, "RdGy")[c(8,10)], </span></span>
<span>           linkColors<span class="op">=</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"Set3"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span>, </span>
<span>           gridColors <span class="op">=</span> <span class="st">"grey"</span>, </span>
<span>           textSize <span class="op">=</span> <span class="fl">1</span>, side_mar<span class="op">=</span><span class="fl">0</span>, top_mar<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="brs-vignette_files/figure-html/plot-chord-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="making-a-t-sne-plot">Making a <em>t</em>-SNE plot<a class="anchor" aria-label="anchor" href="#making-a-t-sne-plot"></a>
</h2>
<p>Finally, we make the <em>t</em>-SNE plot to help visualize the raw
data itself in a low dimensional way. As we recomend in the accompanying
reference paper to this package, we only use the variables that are
included in the final (aggregated) rule set.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_tsne.html">plot_tsne</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">lipset_df</span>, Y <span class="op">=</span> <span class="va">lipset_Y</span>, ruleSet<span class="op">=</span><span class="va">ruleset</span>,</span>
<span>          pointSize <span class="op">=</span> <span class="fl">1.25</span>, symb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>          caseColors<span class="op">=</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">11</span>, <span class="st">"RdYlGn"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">9</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="brs-vignette_files/figure-html/tsne-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Albert Chiu, Yiqing Xu.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
